/*! motion v0.0.0 | (c) 2016, 2016/03/27 | audio loader | motion Foundation, Inc. */
!function(){!function(){!function(){if(!window.Motion){var a={version:"1.1",add:function(a,b){for(var c=window,d=arguments.callee,e=null,f=(/^([\w\.]+)(?:\:([\w\.]+))?\s*$/.test(a),RegExp.$1.split(".")),g=RegExp.$2.split("."),a=f.pop(),h=/[A-Z]/.test(a.substr(0,1)),i=function(){var a=arguments.callee.prototype.init;"function"==typeof a&&arguments.callee.caller!=d&&a&&a.apply(this,arguments)},j=0;j<f.length;j++){var k=f[j];c=c[k]||(c[k]={})}if(""!=g[0]){e=window;for(var j=0;j<g.length;j++)if(e=e[g[j]],!e){e=null;break}}h&&"function"==typeof b?(e&&(i.prototype=new e,i.prototype.superClass=e),c[a]=i,i.prototype.constructor=i,b.call(c[a].prototype)):c[a]=b}};window.Motion=window.mo=a}}()}(),function(){Motion.add("mo.Base",function(){{var a=this;this.constructor}a.constructor=function(){},a.on=function(){return box=Zepto(this),box.on.apply(box,arguments)},a.off=function(){return box=Zepto(this),box.off.apply(box,arguments)},a.trigger=function(){var a=Zepto(this);return a.triggerHandler.apply(a,arguments)}})}(),function(){Motion.add("mo.Audio:mo.Base",function(){var a=this,b={},c=this.constructor;c.config={autoPlay:!0,loop:!0,effect:"none",useWebAudio:!0,fillNum:12},b.effects={cave:"http://ossweb-img.qq.com/images/audio/motion/effect1.wav",lodge:"http://ossweb-img.qq.com/images/audio/motion/effect2.wav",parking:"http://ossweb-img.qq.com/images/audio/motion/effect3.wav",lowpass:"http://ossweb-img.qq.com/images/audio/motion/lowpass.wav",telephone:"http://ossweb-img.qq.com/images/audio/motion/telephone.wav",spatialized:"http://ossweb-img.qq.com/images/audio/motion/spatialized.wav",backwards:"http://ossweb-img.qq.com/images/audio/motion/backwards.wav",wildecho:"http://ossweb-img.qq.com/images/audio/motion/wildecho.wav"};var d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame;a.init=function(a){var e=this,a=e.config=Zepto.extend(!0,{},c.config,a);e.playing=!1;try{e.audioContext=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext)}catch(f){a.useWebAudio=!1}a.fillNum=parseInt(a.fillNum)||4,e.trigger("beforeinit"),b.create.call(e),e.on("init",function(){a.useWebAudio||(e.audio.loop=a.loop),a.autoPlay&&e.play(),b.attach.call(e),d(function(){var a=e.currentTime;e.currentTime=e.audio?e.audio.currentTime:e.audioContext.currentTime,e.frequencyData&&a!==e.currentTime&&e.trigger("progress",e.frequencyData),d(arguments.callee)})})},b.create=function(){var a=this,c=a.config;a.audioContext&&c.useWebAudio?b.get(c.src,function(b){a.arrayBuffer=b,a.trigger("init")},function(){c.useWebAudio=!1,b.create.call(a)}):(a.audio=document.createElement("audio"),a.audio.src=c.src,window.setTimeout(function(){a.trigger("init")},0))},b.attach=function(){var a=this,b=a.config;Zepto(b.controller).on("touchEnd mousedown",function(){a.playing?a.pause():a.play()})},b.getWave=function(){var a=this,b=(a.config,a.audioContext),c=a.analyser=b.createAnalyser();a.analyser.smoothingTimeConstant=.85,a.analyser.fftSize=32,a.frequencyData=new Uint8Array(c.frequencyBinCount)},a.play=function(){var a=this,c=a.config,d=a.currentTime||0;if(!a.playing)if(a.playing=!0,c.useWebAudio){var e=a.sound=a.audioContext.createBufferSource();a.audioContext.decodeAudioData(a.arrayBuffer,function(f){e.buffer=f,e.connect(a.audioContext.destination),e.loop=c.loop,"none"!=c.effect&&a.applyEffect(c.effect),e.start(0,d),b.getWave.call(a),a.analyser.getByteFrequencyData(a.frequencyData),a.sound.connect(a.analyser),c.controller&&b.draw.call(a)})}else a.audio.currentTime=d,a.audio.play(),c.controller&&b.draw.call(a)},a.pause=function(){var a=this,b=a.config;a.playing=!1,b.useWebAudio?(a.sound.stop(),a.currentTime=a.audioContext.currentTime):(a.currentTime=a.audio.currentTime,a.audio.pause())},a.stop=function(){this.pause(),this.currentTime=0},b.createCanvas=function(){var a=this,b=a.config,c=b.controller,d=$("<canvas>").appendTo(b.controller);d=d[0],d.height=c.offset().height,d.width=c.offset().width;var e=d.getContext("2d");e.imageSmoothingEnabled=!1,e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=!1,a.canvas=d},b.draw=function(){function a(){if(c.playing){var b=16;if(e.useWebAudio)c.analyser.getByteFrequencyData(c.frequencyData),b=c.analyser.frequencyBinCount;else{c.frequencyData||(c.frequencyData=[255,254,211,153,127,109,76,35,5,0,0,0,0,0,0,0]);for(var i=0;i<c.frequencyData.length;i++){var j=c.frequencyData[i];j+=20*Math.random()-10,j=j>255?255:j,j=0>j?0:j,c.frequencyData[i]=j}}var k=Math.floor(g.width/e.fillNum);h.clearRect(0,0,g.width,g.height);for(var l,m,n,o,p,i=0;b>i;i++)l=c.frequencyData[i]||0,m=k*i,m+k<g.width&&(n=g.height,o=k-1,p=-(Math.floor(l/255*g.height)+1),h.fillStyle=e.fillColor||f[i]||"#ff0000",h.fillRect(m,n,o,p));c.pause_vis?h.clearRect(0,0,g.width,g.height):d(a)}}var c=this,e=c.config,f=["#ff0000","#ff3300","#ff6600","#ff9900","#ffcc00","#ffff00","#ccff00","#99ff00","#66ff00","#33ff00","#00ff00"];c.canvas||b.createCanvas.call(c);var g=(e.controller,c.canvas),h=c.canvas.getContext("2d");a()},b.get=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType="arraybuffer",d.onload=function(){b&&b.call(this,d.response)},d.onerror=function(a){c&&c.call(this,a)},d.send()},a.applyEffect=function(a){{var c=this;c.config}if(/^http/i.test(a)||(a=b.effects[a]),a){c.convolver&&c.convolver.disconnect();var d=c.convolver=c.audioContext.createConvolver();b.get(a,function(a){c.audioContext.decodeAudioData(a,function(a){console.log(1),d.buffer=a,c.sound.connect(d),d.connect(c.audioContext.destination)})})}}})}(),function(){Motion.add("mo.Loader:mo.Base",function(){var a=this,b={empty:function(){},imgLoader:function(a,b){var c=new Image,d=new Date;c.onload=c.onerror=function(){b(a,c,new Date-d),c.onload=null},c.src=a},jsLoader:function(){var a=document.getElementsByTagName("script")[0],b=a.parentNode,c=/ded|co/,d="onload",e="onreadystatechange",f="readyState";return function(g,h,i){i=i||"gb2312";var j=document.createElement("script"),k=new Date;j.charset=i,j[d]=j[e]=function(){(!this[f]||c.test(this[f]))&&(j[d]=j[e]=null,h&&h(g,j,new Date-k),j=null)},j.async=!0,j.src=g,b.insertBefore(j,a)}}(),cssLoader:function(a,b){var c=document.head||document.getElementsByTagName("head")[0],d=new Date;node=document.createElement("link"),node.rel="stylesheet",node.href=a,c.appendChild(node),b&&b(a,node,new Date-d)},audioLoader:function(a,b){var c=new Audio,d=new Date;$(c).bind("canplaythrough",function(){b(a,c,new Date-d)}),c.src=a,c.load()},getExt:function(a){return a.match(/\.([^\.]*)$/)[0].substr(1).match(/^[a-zA-Z0-9]+/)[0]},getType:function(a){var c=b.getExt(a),d={img:["png","jpg","gif"],css:["css"],js:["js"],audio:["mp3","ogg","wav"]};for(var e in d)if(d[e].indexOf(c)>-1)return e;return!1}},c=this.constructor;a.constructor=function(a,b){a&&this.init(a,b)},c.config={onLoading:b.empty,onComplete:b.empty,loadType:0,minTime:0,dataAttr:"preload"},a.init=function(a,d){var e=this;if("function"==typeof d){var f=d;d={onComplete:f}}e.config=Zepto.extend(!0,{},c.config,d);var d=e.config;a=[].concat(a);var g={},h=Array.prototype.slice.call(document.querySelectorAll("[data-"+d.dataAttr+"]"));Zepto(h).each(function(b,c){var e=Zepto(c),f=e.attr("data-"+d.dataAttr);g[f]?g[f].push(c):(g[f]=[c],a.indexOf(f)<0&&a.push(f))}),d.event&&e.on(d.event);var i=a.length,j=0;Zepto(a).each(function(a,b){if("object"==typeof b){i--;for(var c in b)i++}});var k=(new Date).getTime(),l=function(a){g[a]&&Zepto.each(g[a],function(b,c){c.removeAttribute("data-"+d.dataAttr);var e=c.tagName.toLowerCase();switch(e){case"link":c.href=a;break;case"img":case"script":case"video":c.src=a;break;default:c.style.backgroundImage="url("+a+")"}})},m=function(a,b,c,f){var g=function(){if(d.onLoading(++j,i,a,b),e.trigger("loading",[j,i,a,b]),l(a),f([j,i,a,b]),j==i){var c=(new Date).getTime()-k;d.onComplete(c),e.trigger("complete",[c])}},h=d.minTime-c;h>0?setTimeout(g,h):g()};if(a.length){var n=function(a,c,d){var e=function(a,c,d){var e=b.getType(a),d=d||function(){},f=b[e+"Loader"];void 0===f?c(a,null,0,d):f(a,function(){var a=Array.prototype.slice.call(arguments,0);a.push(d),c.apply(null,a)})};if("object"==typeof a)for(var f in a)!function(a,b){e(b,function(){var d=Zepto(a);d.is("img")?d.attr("src",b):d.css("backgroundImage",'url("'+b+'")');var e=Array.prototype.slice.call(arguments,0);c.apply(null,e)},d)}(f,a[f]);else e(a,c,d)};if(1==d.loadType){var o=0;!function(){var b=arguments.callee;n(a[o],function(){m.apply(null,arguments)},function(){o++,a[o]&&b()})}()}else Zepto.each(a,function(a,b){n(b,m)})}else d.onComplete(0),e.trigger("complete",[0])}})}()}();